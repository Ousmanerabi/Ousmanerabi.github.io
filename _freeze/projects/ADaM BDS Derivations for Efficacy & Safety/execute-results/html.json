{
  "hash": "115b7b6ed443044be75563ead91b6731",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Analysis Data Subject Level (ADSL) Generation with SAS\"\ndescription: \"Automated creation of ADSL dataset for clinical trials analysis using ADaM standards and multi-domain SDTM integration\"\nauthor: \"Ousmane DIALLO\"\ndate: \"`r format(Sys.Date(), '%Y-%m-%d')`\"\ncategories: [ADaM, ADSL, CDISC, SAS, clinical trials, biostatistics, regulatory]\nformat:\n  html:\n    css: ../assets/css/remove-keyword.css\n---\n\n\n*Automated creation of ADSL dataset for clinical trials analysis using ADaM standards and multi-domain SDTM integration.*\n\n[View Code on Github](https://github.com/Ousmanerabi/clinical-trials-programming-portfolio/tree/main/03_ADAM)\n\n## Introduction\n\nThe **Analysis Data Subject Level (ADSL)** dataset is the cornerstone of clinical trial statistical analysis under the CDISC Analysis Data Model (ADaM) standard. ADSL provides one record per subject containing all subject-level information needed for efficacy and safety analyses.\n\n## What is ADSL?\n\nADSL (Analysis Data Subject-Level) dataset is the foundation dataset in ADaM.\n\nIt:\n\n-   Contains one record per subject\n\n-   Includes required subject-level variables (demographic, disposition, baseline values, key date, etc..) as well as other subject-level analysis variables\n\n-   Defines analysis populations (Safety, Intention-To-Treat, Per-Protocol)\n\n-   Provides treatment information (planned and actual treatment) and study periods variables\n\n-   Links to all other ADaM datasets through USUBJID (unique subject identifier)\n\n-   Ensures consistency and traceability across all statistical analyses and reporting\n\n## Regulatory Importance\n\n-   **FDA Requirement**: Essential for regulatory submissions\n\n-   **Analysis Foundation**: Referenced by all Basic Data Structure (BSD) and occurrence Data Structure (OCCDS) datasets\n\n-   **Population Definition**: Critical for primary endpoint analyses\n\n-   **Traceability**: Links analysis results back to SDTM source\n\n## Project Overview\n\n### Objective\n\nCreate a fully compliant ADSL dataset from multiple SDTM domains, implementing analysis populations, treatment variables, and derived endpoints following ADaM Implementation Guide principles.\n\n### Key Benefits\n\n-   **ADSL Dataset**: Subject-level analysis file with proper ADaM structure\n\n-   **Population Flags**: SAFFL, ITTFL, COMPLFL, MITT1FL definitions\n\n-   **Treatment Variables**: Planned and actual treatment assignments\n\n-   **Timing Variables**: Study milestones and treatment periods\n\n-   **Validation Reports**: QC checks ensuring data integrity\n\n### Technical Approach\n\nMulti-domain integration workflow:\n\nSDTM (DM+DS+EX+AE) → Business Logic → Population Flags → Treatment Periods → ADSL\n\n## Data Integration Strategy\n\n### SDTM Source Domains\n\n| **Domain** | **Purpose**             | **Key Variables**            |\n|------------|-------------------------|------------------------------|\n| **DM**     | Demographics & baseline | USUBJID, AGE, SEX, RACE, ARM |\n| **DS**     | Disposition events      | DSSTDTC, DSTERM, DSDECOD     |\n| **EX**     | Exposure/treatment      | EXSTDTC, EXENDTC, EXDOSE     |\n| **AE**     | Adverse events          | AESTDTC, AETERM, AESEV       |\n| **VS**     | Vital signs (if needed) | VSSTDTC, VSTEST, VSORRES     |\n\n: {.striped .hover}\n\n### ADaM Variables to Derive\n\n| **Variable Class** | **Examples** | **Source Logic** |\n|------------------------|------------------------|------------------------|\n| **Required ADaM** | STUDYID, USUBJID, SUBJID | Direct from DM |\n| **Population Flags** | SAFFL, ITTFL, COMPLFL | Business rules from DS/EX |\n| **Treatment** | TRT01P, TRT01A, TRT01PN | From DM.ARM + actual exposure |\n| **Timing** | TRTSDT, TRTEDT, LSTALVDT | From EX + DS disposition |\n| **Demographics** | AGE, AGEGR1, SEX, RACE | Enhanced from DM |\n\n: {.striped .hover}\n\n## Technical Implementation\n\n### 1. Library Setup\n\n```markdown\n```{sas}         \n/* Library and macro setup */\n%include \"/home/u64197545/ADaM/programs/setup.sas\";\n\n/* Expected libraries:\n   - SDTM: Source SDTM datasets\n   - ADAM: Output ADaM datasets  \n   - LIBRARY: Formats and macros\n*/\n\nlibname sdtm \"/home/u64197545/data/sdtm\";\nlibname adam \"/home/u64197545/data/adam\";\nlibname library \"/home/u64197545/data/library\";\n\n/* Load standard ADaM formats */\n%include library(adamfmt);\n```\n\n### 2. Population Definition Logic\n\n```markdown\n```{sas}         \n/* Define analysis populations based on business rules */\n%macro define_populations();\n    \n    /* Safety Population: Any exposure to study drug */\n    proc sql;\n        create table safety_pop as\n        select distinct usubjid, 'Y' as saffl\n        from sdtm.ex\n        where exdose > 0 and exstdtc ne '';\n    quit;\n    \n    /* ITT Population: Randomized subjects */\n    proc sql;\n        create table itt_pop as\n        select distinct usubjid, 'Y' as ittfl\n        from sdtm.dm\n        where arm ne '' and upcase(arm) not in ('SCREEN FAILURE', 'NOT TREATED');\n    quit;\n    \n    /* Completed Population: Finished study per protocol */\n    proc sql;\n        create table completed_pop as\n        select distinct usubjid, 'Y' as complfl\n        from sdtm.ds\n        where upcase(dsdecod) in ('COMPLETED', 'STUDY COMPLETED')\n          and dscat = 'DISPOSITION EVENT';\n    quit;\n\n%mend define_populations;\n\n%define_populations();\n```\n\n### 3. Treatment Period Derivation\n\n```markdown\n``` {sas}\n/* Calculate treatment start and end dates */\nproc sql;\n    create table treatment_period as\n    select usubjid,\n           min(exstdtc) as first_dose_dt format=yymmdd10.,\n           max(case when exendtc ne '' then exendtc else exstdtc end) as last_dose_dt format=yymmdd10.,\n           sum(case when exdose > 0 then 1 else 0 end) as exposure_days\n    from sdtm.ex\n    where exstdtc ne ''\n    group by usubjid;\nquit;\n\n/* Derive analysis treatment dates */\ndata treatment_analysis;\n    set treatment_period;\n    \n    /* Treatment start/end dates for analysis */\n    trtsdt = first_dose_dt;\n    trtedt = last_dose_dt;\n    \n    /* Treatment duration */\n    if trtsdt ne . and trtedt ne . then\n        trtdurd = trtedt - trtsdt + 1;\n    \n    format trtsdt trtedt yymmdd10.;\nrun;\n```\n\n### 4. Study Disposition Integration\n\n```markdown\n```{sas}         \n/* Get key disposition dates and reasons */\nproc sql;\n    create table disposition as\n    select usubjid,\n           case \n               when upcase(dsdecod) = 'INFORMED CONSENT' then dsstdtc\n           end as rficdt format=yymmdd10.,\n           case \n               when upcase(dsdecod) in ('COMPLETED', 'DISCONTINUED') then dsstdtc\n           end as rfendt format=yymmdd10.,\n           case \n               when upcase(dsdecod) = 'DISCONTINUED' then dsterm\n           end as dcsreas\n    from sdtm.ds\n    where dscat = 'DISPOSITION EVENT' and dsstdtc ne '';\nquit;\n\n/* Consolidate to one record per subject */\nproc sql;\n    create table disposition_final as\n    select usubjid,\n           max(rficdt) as rficdt format=yymmdd10.,\n           max(rfendt) as rfendt format=yymmdd10.,\n           max(dcsreas) as dcsreas\n    from disposition\n    group by usubjid;\nquit;\n```\n\n### 5. Last Alive Date Calculation\n\n```markdown\n```{sas}         \n/* Calculate last known alive date from multiple sources */\nproc sql;\n    create table last_alive as\n    select usubjid,\n           max(aestdtc) as last_ae_dt format=yymmdd10.\n    from sdtm.ae\n    where aestdtc ne ''\n    group by usubjid;\nquit;\n\ndata last_alive_calc;\n    merge treatment_analysis\n          disposition_final  \n          last_alive;\n    by usubjid;\n    \n    /* Last alive date = latest of multiple sources */\n    lstalvdt = max(trtedt, rfendt, last_ae_dt);\n    format lstalvdt yymmdd10.;\nrun;\n```\n\n### 6. Combine All ADSL Dataset\n\n```markdown\n```{sas}         \n/* Merge all components to create ADSL */\nproc sql;\n    create table pre_adsl as\n    select dm.*,\n           sp.saffl,\n           itt.ittfl, \n           cp.complfl,\n           ta.trtsdt,\n           ta.trtedt,\n           ta.trtdurd,\n           lac.lstalvdt,\n           disp.rficdt,\n           disp.rfendt,\n           disp.dcsreas\n    from sdtm.dm as dm\n    left join safety_pop as sp on dm.usubjid = sp.usubjid\n    left join itt_pop as itt on dm.usubjid = itt.usubjid  \n    left join completed_pop as cp on dm.usubjid = cp.usubjid\n    left join treatment_analysis as ta on dm.usubjid = ta.usubjid\n    left join last_alive_calc as lac on dm.usubjid = lac.usubjid\n    left join disposition_final as disp on dm.usubjid = disp.usubjid;\nquit;\n\n/* Apply ADaM standards and derive final variables */\ndata adam.adsl;\n    set pre_adsl;\n    \n    /* Required ADaM variables */\n    studyid = upcase(studyid);\n    \n    /* Population flags - default to 'N' if missing */\n    if saffl = '' then saffl = 'N';\n    if ittfl = '' then ittfl = 'N'; \n    if complfl = '' then complfl = 'N';\n    \n    /* Treatment variables */\n    trt01p = strip(arm);        /* Planned treatment */\n    trt01pn = input(armcd, best.); /* Planned treatment (N) */\n    trt01a = strip(actarm);     /* Actual treatment */\n    trt01an = input(actarmcd, best.); /* Actual treatment (N) */\n    \n    /* Age groupings for analysis */\n    if age ne . then do;\n        if age < 65 then agegr1 = '<65';\n        else if age >= 65 then agegr1 = '>=65';\n        \n        if age < 18 then agegr1n = 1;\n        else if 18 <= age < 65 then agegr1n = 2;\n        else if age >= 65 then agegr1n = 3;\n    end;\n    \n    /* Race groupings */\n    if upcase(race) = 'WHITE' then racen = 1;\n    else if upcase(race) = 'BLACK OR AFRICAN AMERICAN' then racen = 2;\n    else if upcase(race) = 'ASIAN' then racen = 3;\n    else racen = 4;\n    \n    /* Sex numeric */\n    if upcase(sex) = 'M' then sexn = 1;\n    else if upcase(sex) = 'F' then sexn = 2;\n    \n    /* Study day calculations */\n    if trtsdt ne . and rfstdtc ne '' then\n        trtsdt = input(rfstdtc, yymmdd10.);\n    \n    if trtedt ne . and rfendtc ne '' then\n        trtedt = input(rfendtc, yymmdd10.);\n    \n    /* Format assignments */\n    format trtsdt trtedt lstalvdt rficdt rfendt yymmdd10.;\n    \n    /* Variable labels */\n    label studyid = 'Study Identifier'\n          usubjid = 'Unique Subject Identifier'\n          subjid = 'Subject Identifier for the Study'\n          siteid = 'Study Site Identifier'\n          age = 'Age'\n          agegr1 = 'Pooled Age Group 1'\n          agegr1n = 'Pooled Age Group 1 (N)'\n          sex = 'Sex'\n          sexn = 'Sex (N)'\n          race = 'Race'\n          racen = 'Race (N)'\n          saffl = 'Safety Population Flag'\n          ittfl = 'Intent-To-Treat Population Flag'\n          complfl = 'Completers Population Flag'\n          trt01p = 'Planned Treatment for Period 01'\n          trt01pn = 'Planned Treatment for Period 01 (N)'\n          trt01a = 'Actual Treatment for Period 01'\n          trt01an = 'Actual Treatment for Period 01 (N)'\n          trtsdt = 'Date of First Exposure to Treatment'\n          trtedt = 'Date of Last Exposure to Treatment'\n          trtdurd = 'Total Treatment Duration (Days)'\n          lstalvdt = 'Last Known Alive Date'\n          dcsreas = 'Reason for Discontinuation from Study';\nrun;\n```\n\n### Quality Control & Validation\n\n#### 1. Population Reconciliation\n\n```markdown\n```{sas}         \n/* Verify population counts */\nproc freq data=adam.adsl;\n    title \"Analysis Population Counts\";\n    tables saffl ittfl complfl / missing;\nrun;\n\n/* Cross-tabulation of populations */\nproc freq data=adam.adsl;\n    title \"Population Overlap Analysis\";\n    tables saffl*ittfl*complfl / missing list;\nrun;\n```\n\n#### 2. Treatment Assigment Validation\n\n```markdown\n``` {sas}\n/* Planned vs Actual treatment comparison */\nproc freq data=adam.adsl;\n    title \"Planned vs Actual Treatment\";\n    tables trt01p*trt01a / missing list;\nrun;\n\n/* Treatment duration summary */\nproc means data=adam.adsl n mean std min max;\n    title \"Treatment Duration Summary\";\n    var trtdurd;\n    class trt01p;\nrun;\n```\n\n#### 3. Data Integrity Checks\n\n```markdown\n```{sas}\n/* Check for missing key variables */\nproc sql;\n    title \"Missing Key Variables Check\";\n    select \n        sum(case when usubjid = '' then 1 else 0 end) as missing_usubjid,\n        sum(case when studyid = '' then 1 else 0 end) as missing_studyid,\n        sum(case when saffl = '' then 1 else 0 end) as missing_saffl,\n        sum(case when ittfl = '' then 1 else 0 end) as missing_ittfl\n    from adam.adsl;\nquit;\n\n/* Validate date logic */\nproc sql;\n    title \"Date Logic Validation\";\n    select usubjid, trtsdt, trtedt, trtdurd\n    from adam.adsl\n    where trtsdt > trtedt or (trtsdt ne . and trtedt ne . and trtdurd ne (trtedt-trtsdt+1));\nquit;\n```\n\n#### 4. Cross-Domain Consistency\n\n```markdown\n```{sas}\n/* Compare ADSL counts with SDTM DM */\nproc sql;\n    title \"Subject Count Reconciliation\";\n    select 'SDTM.DM' as dataset, count(*) as n_subjects from sdtm.dm\n    union\n    select 'ADAM.ADSL' as dataset, count(*) as n_subjects from adam.adsl;\nquit;\n```\n\n### Results\n\n#### **Sample output**:\n\n| SUBJID  | STUDYID | TRT01P  | SAFFL | ITTFL | TRTSDT     | TRTEDT     | AGE | SEX |\n|---------|---------|---------|-------|-------|------------|------------|-----|-----|\n| 001-001 | XYZ123  | Placebo | Y     | Y     | 2023-01-15 | 2023-03-15 | 45  | M   |\n| 001-002 | XYZ123  | Active  | Y     | Y     | 2023-01-16 | 2023-03-14 | 52  | F   |\n\n: {.striped .hover}\n\n#### Dataset Specifications\n\n| **Aspect**       | **Specification**               |\n|------------------|---------------------------------|\n| **Structure**    | One record per subject          |\n| **Key Variable** | USUBJID (unique identifier)     |\n| **Records**      | N = total randomized subjects   |\n| **Variables**    | 25+ analysis variables          |\n| **Populations**  | Safety, ITT, Completers defined |\n| **Standards**    | ADaM IG v1.3 compliant          |\n\n: {.striped .hover}\n## Business Impact\n\n### Analytical Foundation\n\n-   **Primary Analysis**: Enables all efficacy endpoints\n\n-   **Safety Analysis**: Population definitions for AE analysis\n\n-   **Regulatory Submission**: Core dataset for FDA/EMA review\n\n-   **Study Operations**: Treatment duration and compliance metrics\n\n### Technical Achievements\n\n-   **Multi-domain Integration**: Seamless SDTM to ADaM workflow\n\n-   **Business Logic Implementation**: Complex population definitions\n\n-   **Data Quality**: Comprehensive validation framework\n\n-   **Regulatory Compliance**: 100% ADaM IG adherence\n\n## Contact\n\nInterested in this project or my expertise in biostatistics and CDISC standards?\n\n[**Send an Email**](ousmanerabi12@gmail.com) \\| [**LinkedIn**](www.linkedin.com/in/ousmane-diallo8)\n\n",
    "supporting": [
      "ADaM BDS Derivations for Efficacy & Safety_files"
    ],
    "filters": [],
    "includes": {}
  }
}