<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-08-30">
<meta name="description" content="Quantify the trend in malaria incidence at health district level and identify the factors associated with malaria incidence in Burkina Faso from 2016-2023 using routine cases data">

<title>Time Series Analysis of Malaria Trends — Burkina Faso (2016–2023)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="retrospective_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="retrospective_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="retrospective_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="retrospective_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="retrospective_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="retrospective_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="retrospective_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="retrospective_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="retrospective_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="retrospective_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data sources</a></li>
  <li><a href="#data-management" id="toc-data-management" class="nav-link" data-scroll-target="#data-management">Data management</a></li>
  <li><a href="#incidence-adjustments" id="toc-incidence-adjustments" class="nav-link" data-scroll-target="#incidence-adjustments">Incidence adjustments</a></li>
  <li><a href="#trend-quantification" id="toc-trend-quantification" class="nav-link" data-scroll-target="#trend-quantification">Trend quantification</a></li>
  <li><a href="#factors-associated-with-incidence" id="toc-factors-associated-with-incidence" class="nav-link" data-scroll-target="#factors-associated-with-incidence">Factors associated with incidence</a></li>
  </ul></li>
  <li><a href="#key-deliverables" id="toc-key-deliverables" class="nav-link" data-scroll-target="#key-deliverables">Key Deliverables</a></li>
  <li><a href="#visual-highlights" id="toc-visual-highlights" class="nav-link" data-scroll-target="#visual-highlights">Visual Highlights</a>
  <ul class="collapse">
  <li><a href="#reporting-rate" id="toc-reporting-rate" class="nav-link" data-scroll-target="#reporting-rate">1. Reporting rate</a></li>
  <li><a href="#incidence-estimates" id="toc-incidence-estimates" class="nav-link" data-scroll-target="#incidence-estimates">2. Incidence estimates</a></li>
  <li><a href="#malaria-incidence-trends" id="toc-malaria-incidence-trends" class="nav-link" data-scroll-target="#malaria-incidence-trends">3. Malaria Incidence Trends</a></li>
  </ul></li>
  <li><a href="#code-example" id="toc-code-example" class="nav-link" data-scroll-target="#code-example">Code example</a>
  <ul class="collapse">
  <li><a href="#normalize-function" id="toc-normalize-function" class="nav-link" data-scroll-target="#normalize-function">Normalize Function</a></li>
  </ul></li>
  <li><a href="#repository-reproducibility" id="toc-repository-reproducibility" class="nav-link" data-scroll-target="#repository-reproducibility">Repository &amp; Reproducibility</a></li>
  <li><a href="#public-health-relevance" id="toc-public-health-relevance" class="nav-link" data-scroll-target="#public-health-relevance">Public Health Relevance</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Time Series Analysis of Malaria Trends — Burkina Faso (2016–2023)</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">Epidemiology</div>
    <div class="quarto-category">Malaria</div>
    <div class="quarto-category">DHS</div>
    <div class="quarto-category">climate</div>
    <div class="quarto-category">Time series</div>
  </div>
  </div>

<div>
  <div class="description">
    Quantify the trend in malaria incidence at health district level and identify the factors associated with malaria incidence in Burkina Faso from 2016-2023 using routine cases data
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p><strong>Period:</strong> 2016–2023 · <strong>Role:</strong> Lead Data Analyst · <strong>Location:</strong> Burkina Faso</p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://github.com/Ousmanerabi/Retrospective_analysis"><img src="https://img.shields.io/badge/View%20Code-GitHub-black?logo=github.png" class="img-fluid" alt="View Code"></a><br>
<a href="https://ousmanerabi.github.io/projects/"><img src="https://img.shields.io/badge/←%20Back-Projects-blue.png" class="img-fluid" alt="← Back to Projects"></a></p>
</div>
</div>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The aim of this study was to assess the malaria trends in Burkina Faso at the health district level to help understand the malaria transmission level between 2016 and 2023 and to determine the factors associated with malaria incidence to better understand the drivers of malaria in Burkina Faso. This analysis combined publicly available DHS/MIS and climate data with restricted HMIS surveillance data obtained from PNLP under data sharing agreement.</p>
<p><strong>Role:</strong> Sole author responsible for data cleaning, quality assessment, analysis, modeling, mapping, and reporting.</p>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<section id="data-sources" class="level3">
<h3 class="anchored" data-anchor-id="data-sources">Data sources</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Definition</th>
<th>Source</th>
<th>Temporal</th>
<th>Period</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Suspected cases</td>
<td>Clinical malaria suspicion (fever)</td>
<td>HMIS</td>
<td>Monthly</td>
<td>2016–2023 (excl. 2019)</td>
</tr>
<tr class="even">
<td>Tested cases</td>
<td>Received RDT or microscopy</td>
<td>HMIS</td>
<td>Monthly</td>
<td>2016–2023</td>
</tr>
<tr class="odd">
<td>Confirmed cases</td>
<td>Positive RDT or microscopy</td>
<td>HMIS</td>
<td>Monthly</td>
<td>2016–2023</td>
</tr>
<tr class="even">
<td>Presumed cases</td>
<td>Treated without positive test</td>
<td>HMIS</td>
<td>Monthly</td>
<td>2016–2023</td>
</tr>
<tr class="odd">
<td>Population</td>
<td>District population</td>
<td>HMIS</td>
<td>Annual (Monthy est)</td>
<td>2016–2023</td>
</tr>
<tr class="even">
<td>Treatment-seeking (U5)</td>
<td>Public/private/no care</td>
<td>DHS/MIS</td>
<td>Every 3 years</td>
<td>2014, 2017–18, 2021</td>
</tr>
</tbody>
</table>
</section>
<section id="data-management" class="level3">
<h3 class="anchored" data-anchor-id="data-management">Data management</h3>
<p>I applied a standard data quality workflow before analysis:</p>
<ul>
<li><p>Standardized district and facility names across years.</p></li>
<li><p>Removed duplicates/inconsistencies; harmonized facility identifiers.</p></li>
<li><p>Classified facility reporting activity (active vs.&nbsp;inactive).</p></li>
<li><p>Detected and imputed outliers using <strong>3 mean+-SD</strong>, <strong>Median absolute deviation (MAD)</strong>, and <strong>Iinterquartile range</strong> rules.</p></li>
<li><p>Managed missingness; validated reporting rates.</p></li>
</ul>
</section>
<section id="incidence-adjustments" class="level3">
<h3 class="anchored" data-anchor-id="incidence-adjustments">Incidence adjustments</h3>
<p>Crude malaria incidence was calculated by dividing the number of reported confirmed cases for each health district and month by the district population and multiplying by 1000. Then, crude incidence was adjusted for each factor in accordance with the WHO framework.</p>
</section>
<section id="trend-quantification" class="level3">
<h3 class="anchored" data-anchor-id="trend-quantification">Trend quantification</h3>
<ul>
<li><strong>STL decomposition</strong> (LOESS) to separate seasonal, trend, residual components.</li>
<li><strong>Sen’s slope</strong> for monotonic trend magnitude.</li>
<li><strong>Mann–Kendall</strong> test for trend significance (α = 0.05).</li>
</ul>
</section>
<section id="factors-associated-with-incidence" class="level3">
<h3 class="anchored" data-anchor-id="factors-associated-with-incidence">Factors associated with incidence</h3>
<p>Outcome: annual incidence adjusted for testing, reporting, treatment-seeking (Adjustment 3).<br>
Covariates (2016–2023): climate, Insecticide Treated nets access/use, Seasonal Malaria Chemoprevention coverage, stockouts (Rapid Diagnostic Test/ACT/IPTp).<br>
Model: <strong>Generalized Additive Models (GAMs)</strong> for nonlinear effects.</p>
</section>
</section>
<section id="key-deliverables" class="level2">
<h2 class="anchored" data-anchor-id="key-deliverables">Key Deliverables</h2>
<ul>
<li>Malaria burden estimated under four incidence definitions (2016–2023).</li>
<li>Trend analysis (seasonal + long-term) by district for each incidence definition.</li>
<li>Significant covariates associated with adjusted incidence.</li>
</ul>
</section>
<section id="visual-highlights" class="level2">
<h2 class="anchored" data-anchor-id="visual-highlights">Visual Highlights</h2>
<section id="reporting-rate" class="level3">
<h3 class="anchored" data-anchor-id="reporting-rate">1. Reporting rate</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/weighted.png" class="img-fluid figure-img" width="422"></p>
<figcaption>Fig. Monthly reporting rates per health district</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Insight:</strong> Data quality varied considerably from district to district. Some districts reported less than 50% during certain periods, which significantly skewed the crude incidence estimates.</p>
</div>
</div>
<hr>
</section>
<section id="incidence-estimates" class="level3">
<h3 class="anchored" data-anchor-id="incidence-estimates">2. Incidence estimates</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fichier2-02.png" class="img-fluid figure-img" width="573"></p>
<figcaption>Fig. Incidence estimates following WHO framework. A-D: Temporal trend for the four incidences (crude incidence, incidence adjusted by testing rate, incidence adjusted by testing rate and reporting rate, incidence adjusted by testing rate, reporting rate and care-seeking rate; E-D: Spatial analysis for the four incidences from 2023.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Insight:</strong> Crude incidence and Adjustment 1 were nearly identical across districts, reflecting strong case management policies that ensure treatment follows testing. However, Adjustments 2 and 3 revealed hidden burden: poor reporting completeness in 2023 inflated incidence in several northern and eastern districts, while accounting for care-seeking (Adjustment 3) added ~450 cases per 1,000 in Gorom-Gorom, Gaoua, Kaya, Boussouma, and Fada. This underscores the importance of integrating care-seeking behavior into malaria burden estimates.</p>
</div>
</div>
<hr>
</section>
<section id="malaria-incidence-trends" class="level3">
<h3 class="anchored" data-anchor-id="malaria-incidence-trends">3. Malaria Incidence Trends</h3>
<section id="sens-slope-coefficient-mann-kendall-test" class="level4">
<h4 class="anchored" data-anchor-id="sens-slope-coefficient-mann-kendall-test">Sen’s slope coefficient (Mann kendall test)</h4>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/Fichier5-02.png" class="img-fluid figure-img" width="533"></p>
<figcaption>Fig. Sen’s slope coefficient for the trend of malaria incidence adjusted for testing rate, weighted reporting rate and care-seeking rate; Gray color: not significant.</figcaption>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Insight:</strong> Trend analysis (Mann-Kendall) of Adjustment 3 showed heterogeneity across districts: Gorom-Gorom, Sapone, and Kampti had significant upward trends, while 39 of 70 districts experienced significant declines, reflecting improved malaria control or reduced transmission in much of Burkina Faso</p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="code-example" class="level2">
<h2 class="anchored" data-anchor-id="code-example">Code example</h2>
<section id="normalize-function" class="level3">
<h3 class="anchored" data-anchor-id="normalize-function">Normalize Function</h3>
<p>This function standardizes the four malaria incidence indicators so they can be compared on the same scale across districts.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Reproducibility Note:</strong><br>
All analyses are fully reproducible in R. This snippet shows how indicators were normalized prior to trend analysis.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Function for normalize the four incidences rates (comparaison purpose)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>getNormalized <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(vec) <span class="sc">||</span> <span class="fu">all</span>(<span class="fu">is.na</span>(vec))) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"Input vector is non-numeric or all NA; returning original vector"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(vec)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  vec_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  vec_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(vec_sd) <span class="sc">||</span> vec_sd <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"Standard deviation is 0 or NA; returning original vector"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(vec)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  (vec <span class="sc">-</span> vec_mean) <span class="sc">/</span> vec_sd</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Create new variables to use in the trend analysis</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>monthly_DS_incidence <span class="ot">&lt;-</span> monthly_DS_incide <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mal_cases_norm =</span> <span class="fu">getNormalized</span>(<span class="st">`</span><span class="at">Incidence brute</span><span class="st">`</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">incidence_adj_presumed_cases_norm =</span> <span class="fu">getNormalized</span>(Adj1),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">incidence_adj_presumed_cases_RR_norm =</span> <span class="fu">getNormalized</span>(Adj2),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">incidence_adj_presumed_cases_RR_TSR_norm =</span> <span class="fu">getNormalized</span>(Adj3)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="stl-decomposition" class="level4">
<h4 class="anchored" data-anchor-id="stl-decomposition">STL Decomposition</h4>
<p>This function decomposes the normalized time series into seasonal, trend, and remainder components, and applies Mann-Kendall and Sen’s slope tests to assess statistical significance.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Key Insight:</strong><br>
STL decomposition helped disentangle seasonal variation from long-term malaria trends, allowing robust detection of increasing or decreasing trajectories at the district level.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## STL decomposition</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>STL_result_DF_norm_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>indicators <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"mal_cases_norm"</span>, <span class="at">type =</span> <span class="st">"Crude Incidence"</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"incidence_adj_presumed_cases_norm"</span>, <span class="at">type =</span> <span class="st">"Adjusted Presumed Cases"</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"incidence_adj_presumed_cases_RR_norm"</span>, <span class="at">type =</span> <span class="st">"Adjusted Presumed Cases RR"</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">col =</span> <span class="st">"incidence_adj_presumed_cases_RR_TSR_norm"</span>, <span class="at">type =</span> <span class="st">"Adjusted Presumed Cases RR TSR"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Monthly data</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>monthly_DS_incidence <span class="ot">=</span> monthly_DS_incidence </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">## loop</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (DS <span class="cf">in</span> base<span class="sc">::</span><span class="fu">sort</span>(base<span class="sc">::</span><span class="fu">unique</span>(monthly_DS_incidence<span class="sc">$</span>districts))) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  cases_dist <span class="ot">&lt;-</span> monthly_DS_incidence <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(districts <span class="sc">==</span> DS) <span class="sc">%&gt;%</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(Date)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(cases_dist) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"No data for district:"</span>, DS, <span class="st">"- skipping"</span>))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ind <span class="cf">in</span> indicators) {</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>ind<span class="sc">$</span>col <span class="sc">%in%</span> <span class="fu">names</span>(cases_dist)) {</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Column"</span>, ind<span class="sc">$</span>col, <span class="st">"not found in district"</span>, DS, <span class="st">"- skipping"</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    ind_values <span class="ot">&lt;-</span> cases_dist[[ind<span class="sc">$</span>col]]</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    valid_idx <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(ind_values)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    valid_ind_norm <span class="ot">&lt;-</span> ind_values[valid_idx]</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    valid_dates <span class="ot">&lt;-</span> cases_dist<span class="sc">$</span>Date[valid_idx]</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(valid_ind_norm) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Fewer than 2 valid observations for"</span>, ind<span class="sc">$</span>col, <span class="st">"in district"</span>, DS, <span class="st">"- skipping"</span>))</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    start_year <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">as.numeric</span>(<span class="fu">format</span>(valid_dates[<span class="dv">1</span>], <span class="st">"%Y"</span>))</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    start_month <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">as.numeric</span>(<span class="fu">format</span>(valid_dates[<span class="dv">1</span>], <span class="st">"%m"</span>))</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    ind_ts <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">ts</span>(valid_ind_norm, <span class="at">start =</span> <span class="fu">c</span>(start_year, start_month), <span class="at">deltat =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    ind_stl <span class="ot">&lt;-</span> stlplus<span class="sc">::</span><span class="fu">stlplus</span>(ind_ts, <span class="at">s.window =</span> <span class="st">"periodic"</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    ind_stl_ts <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">as.data.frame</span>(ind_stl<span class="sc">$</span>data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    ind_stl_ts<span class="sc">$</span>type <span class="ot">&lt;-</span> ind<span class="sc">$</span>type</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    ind_stl_ts<span class="sc">$</span>dates <span class="ot">&lt;-</span> valid_dates</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    ind_stl_ts<span class="sc">$</span>MK_p <span class="ot">&lt;-</span> trend<span class="sc">::</span><span class="fu">smk.test</span>(ind_ts)<span class="sc">$</span>p.value</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    ind_stl_ts<span class="sc">$</span>sens_slope <span class="ot">&lt;-</span> trend<span class="sc">::</span><span class="fu">sea.sens.slope</span>(ind_ts)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    ind_stl_ts<span class="sc">$</span>District <span class="ot">&lt;-</span> DS</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    STL_result_DF_norm_list[[base<span class="sc">::</span><span class="fu">paste</span>(DS, ind<span class="sc">$</span>col, <span class="at">sep =</span> <span class="st">"_"</span>)]] <span class="ot">&lt;-</span> ind_stl_ts</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>STL_result_DF_norm <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>(STL_result_DF_norm_list, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>STL_result_DF_slopes <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">unique</span>(STL_result_DF_norm[, <span class="fu">c</span>(<span class="st">"type"</span>, <span class="st">"MK_p"</span>, <span class="st">"sens_slope"</span>, <span class="st">"District"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="repository-reproducibility" class="level2">
<h2 class="anchored" data-anchor-id="repository-reproducibility">Repository &amp; Reproducibility</h2>
<ul>
<li><p><strong>Repository:</strong> <a href="https://github.com/Ousmanerabi/Retrospective_analysis">Full code</a></p></li>
<li><p><strong>Data:</strong></p>
<ul>
<li><strong>Public datasets:</strong> DHS, MIS, and climate datasets (e.g., CHIRPS rainfall) are fully open-access.</li>
<li><strong>Restricted datasets:</strong> Routine HMIS surveillance data and intervention coverage data (ITN, SMC, RDT, ACT, IPTp stockouts) are not publicly available and were accessed under agreement with the Burkina Faso National Malaria Control Programme (PNLP).</li>
</ul>
<p>For reproducibility, all <strong>data management scripts</strong> and <strong>statistical analysis code</strong> are provided. Analyses relying on restricted data are demonstrated using mock or simulated datasets.</p></li>
</ul>
</section>
<section id="public-health-relevance" class="level2">
<h2 class="anchored" data-anchor-id="public-health-relevance">Public Health Relevance</h2>
<ul>
<li>Demonstrated how data quality issues (reporting gaps, inactive facilities) bias malaria burden estimation.</li>
<li>Provided robust adjusted incidence trends to better inform malaria control strategy in Burkina Faso.</li>
<li>Delivered reproducible R workflow (cleaning, validation, modeling, mapping) for future NMCP analyses.</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>